name: Terraform validation
on: [push]
jobs:
  terraform-plan:
    runs-on: ubuntu-latest
    environment: aws_credentials
    steps:
      - name: debug
        run: echo $AWS_REGION
      - name: add hashicorp key
        run: curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
      - name: add repo
        run: sudo apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
      - name: install terraform
        run: sudo apt update && sudo apt install terraform
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: Export aws credentials
        run: > 
          export AWS_ACCESS_KEY_ID="${{ secrets.AWS_ACCESS_KEY_ID }}"
          export AWS_SECRET_ACCESS_KEY="${{ secrets.AWS_SECRET_ACCESS_KEY }}"
          export AWS_REGION="${{ secrets.AWS_REGION }}"
      - run: terraform init
      - run: terraform plan
      - run: echo "üçè This job's status is ${{ job.status }}."

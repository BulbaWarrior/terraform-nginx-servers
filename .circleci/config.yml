# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
# Use a package of configuration called an orb.


jobs:
  terraform-apply:
    docker:
      - image: ubuntu
    steps:
      - run:
          name: add hashicorp key
          command: curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
      - run:
          name: add repo
          command: sudo apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
      - run:
          name: install terraform
          command: sudo apt update && sudo apt install terraform
      - checkout
      - run: terraform init
      - run: terraform apply 
# Orchestrate or schedule a set of jobs
workflows:
  # Name the workflow "welcome"
  terraform:
    # Run the welcome/run job in its own container
    jobs:
      - terraform-apply
